<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audiencias - Agenda Legal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Sidebar de navegación -->
    <div class="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-gavel fa-2x"></i>
            <h2>Agenda Legal</h2>
        </div>
        <div class="sidebar-nav">
            <a href="index.html" class="nav-item">
                <i class="fas fa-home"></i>
                <span>Inicio</span>
            </a>
            <a href="dashboard.html" class="nav-item">
                <i class="fas fa-chart-bar"></i>
                <span>Dashboard</span>
            </a>
            <a href="audiencias.html" class="nav-item active">
                <i class="fas fa-gavel"></i>
                <span>Audiencias</span>
            </a>
            <a href="terminos.html" class="nav-item">
                <i class="fas fa-clock"></i>
                <span>Términos</span>
            </a>
            <a href="asuntos.html" class="nav-item">
                <i class="fas fa-folder-open"></i>
                <span>Asuntos</span>
            </a>
            <a href="agenda-general.html" class="nav-item">
                <i class="fas fa-calendar-alt"></i>
                <span>Agenda General</span>
            </a>
            <a href="notificaciones.html" class="nav-item">
                <i class="fas fa-bell"></i>
                <span>Notificaciones</span>
            </a>
        </div>
    
       
    </div>
    
    <!-- Contenido principal -->
    <div class="main-content">
        <div class="container">
            <header>
                <div class="header-content">
                    <h1><i class="fas fa-gavel"></i> Audiencias - Agenda Legal</h1>
                    <div class="user-info">
                        <i class="fas fa-user-circle"></i> Usuario Abogado
                    </div>
                </div>
            </header>
            
            <!-- Tabla de Audiencias -->
            <div class="tab-content active" id="audiencias">
                <div class="toolbar">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="search-audiencias" placeholder="Buscar en audiencias...">
                    </div>
                    <button class="btn btn-primary" id="add-audiencia">
                        <i class="fas fa-plus"></i> Nueva Audiencia
                    </button>
                </div>
                
                <!-- Filtros para audiencias -->
                <div class="filters">
                    <div class="filters-title">
                        <i class="fas fa-filter"></i> Filtros de Audiencias
                    </div>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="filter-tipo">Tipo de Audiencia</label>
                            <select id="filter-tipo">
                                <option value="">Todos los tipos</option>
                                <option value="Inicial">Inicial</option>
                                <option value="Intermedia">Intermedia</option>
                                <option value="Ratificación">Ratificación</option>
                                <option value="Admisión">Admisión</option>
                                <option value="Confesional">Confesional</option>
                                <option value="Reanudacion">Reanudación</option>
                                <option value="Incidental">Incidental</option>
                                <option value="Constitucional">Constitucional</option>
                            </select>
                        </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="audiencia-notify-days">Recordatorio días antes</label>
                            <input type="number" id="audiencia-notify-days" min="1" placeholder="Ej. 7 (días antes)">
                            <small>Dejar vacío si no desea recordatorio por días</small>
                        </div>
                        <div class="form-group">
                            <label for="audiencia-notify-hours">Recordatorio horas antes</label>
                            <input type="number" id="audiencia-notify-hours" min="1" placeholder="Ej. 24 (horas antes)">
                            <small>Dejar vacío si no desea recordatorio por horas</small>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" id="cancel-audiencia">Cancelar</button>
                <button class="btn btn-success" id="save-audiencia">Guardar Audiencia</button>
            </div>
        </div>
    </div>
        <!-- nuevo modal  -->
    <!-- Modal Comentarios -->
        <div class="modal" id="modal-comentarios">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
            <h2>Comentarios de la audiencia</h2>
            <button class="btn btn-danger" id="close-modal-comentarios">
                <i class="fas fa-times"></i>
            </button>
            </div>

            <div class="modal-body">
            <input type="hidden" id="comentarios-audiencia-id">
            
            <div class="form-group">
                <label for="nuevo-comentario">Nuevo comentario</label>
                <textarea id="nuevo-comentario" rows="3" placeholder="Escribe tu comentario..."></textarea>
            </div>

            <div class="modal-footer" style="padding-left: 0;">
                <button class="btn btn-success" id="save-comentario">
                <i class="fas fa-paper-plane"></i> Guardar comentario
                </button>
            </div>

            <hr>

            <div>
                <h3 style="margin-top: 0;">Historial</h3>
                <ul id="lista-comentarios" class="comment-list" style="list-style: none; padding-left: 0; margin: 0;">
                <!-- Se llena dinámicamente -->
                </ul>
            </div>
            </div>
        </div>
        </div>

    <!-- Scripts -->
    <script src="js/notificaciones.js"></script>
    <script src="js/audiencias.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof initAudiencias === 'function') {
                initAudiencias();
            }
            initModalAudiencias();
             initModalComentarios(); // <- AÑADIDO
        });

        function initModalAudiencias() {
            // Modal de audiencias
            const modalAudiencia = document.getElementById('modal-audiencia');
            const btnAddAudiencia = document.getElementById('add-audiencia');
            const btnCloseAudiencia = document.getElementById('close-modal-audiencia');
            const btnCancelAudiencia = document.getElementById('cancel-audiencia');
            const btnSaveAudiencia = document.getElementById('save-audiencia');

            // Abrir modal
            if (btnAddAudiencia) {
                btnAddAudiencia.addEventListener('click', function() {
                    openAudienciaModal();
                });
            }

            // Cerrar modal
            if (btnCloseAudiencia) {
                btnCloseAudiencia.addEventListener('click', function() {
                    modalAudiencia.style.display = 'none';
                });
            }

            if (btnCancelAudiencia) {
                btnCancelAudiencia.addEventListener('click', function() {
                    modalAudiencia.style.display = 'none';
                });
            }

            // Guardar audiencia
            if (btnSaveAudiencia) {
                btnSaveAudiencia.addEventListener('click', function() {
                    saveAudiencia();
                });
            }

            // Cerrar modal al hacer clic fuera
            window.addEventListener('click', function(event) {
                if (event.target === modalAudiencia) {
                    modalAudiencia.style.display = 'none';
                }
            });
        }

        function openAudienciaModal(audiencia = null) {
            const modal = document.getElementById('modal-audiencia');
            const title = document.getElementById('modal-audiencia-title');
            const form = document.getElementById('form-audiencia');
            
            if (audiencia) {
                title.textContent = 'Editar Audiencia';
                document.getElementById('audiencia-id').value = audiencia.id;
                document.getElementById('audiencia-fecha').value = audiencia.fecha;
                document.getElementById('audiencia-hora').value = audiencia.hora;
                document.getElementById('audiencia-tipo').value = audiencia.tipo;
                document.getElementById('audiencia-materia').value = audiencia.materia;
                document.getElementById('audiencia-tribunal').value = audiencia.tribunal;
                document.getElementById('audiencia-expediente').value = audiencia.expediente;
                document.getElementById('audiencia-actor').value = audiencia.actor;
                document.getElementById('audiencia-demandado').value = audiencia.demandado;
                document.getElementById('audiencia-observaciones').value = audiencia.observaciones;
                document.getElementById('audiencia-prioridad').value = audiencia.prioridad;
            } else {
                title.textContent = 'Nueva Audiencia';
                if (form) form.reset();
                document.getElementById('audiencia-id').value = '';
            }
            
            modal.style.display = 'flex';
        }

        function saveAudiencia() {
            const id = document.getElementById('audiencia-id').value;
            const fecha = document.getElementById('audiencia-fecha').value;
            const hora = document.getElementById('audiencia-hora').value;
            const tipo = document.getElementById('audiencia-tipo').value;
            const materia = document.getElementById('audiencia-materia').value;
            const tribunal = document.getElementById('audiencia-tribunal').value;
            const expediente = document.getElementById('audiencia-expediente').value;
            const actor = document.getElementById('audiencia-actor').value;
            const demandado = document.getElementById('audiencia-demandado').value;
            const observaciones = document.getElementById('audiencia-observaciones').value;
            const prioridad = document.getElementById('audiencia-prioridad').value;
            
            if (!fecha || !hora || !tipo || !materia || !tribunal || !expediente || !actor || !demandado || !prioridad) {
                alert('Por favor, complete todos los campos obligatorios');
                return;
            }

            // Registrar notificación si corresponde
            try {
                const notifyType = document.getElementById('audiencia-notify-type').value;
                const offset = document.getElementById('audiencia-notify-offset').value;
                const eventISO = fecha + 'T' + hora;
                if (notifyType && offset && window.Notificaciones && typeof window.Notificaciones.add === 'function') {
                    window.Notificaciones.add({
                        eventType: 'audiencia',
                        title: tipo + ' - ' + tribunal,
                        expediente: expediente,
                        eventAtISO: eventISO,
                        notifyType: notifyType,
                        offset: Number(offset)
                    });
                }
            } catch (e) {
                console.warn('No se pudo registrar notificación', e);
            }
                        <div class="filter-group">
                            <label for="filter-gerencia">Gerencias</label>
                            <select id="filter-gerencia">
                                <option value="">Todos los estados</option>
                                <option value="Aguascalientes">Aguascalientes</option>
                                <option value="Baja California">Baja California</option>
                                <option value="Baja California Sur">Baja California Sur</option>
                                <option value="Campeche">Campeche</option>
                                <option value="Chiapas">Chiapas</option>
                                <option value="Chihuahua">Chihuahua</option>
                                <option value="Ciudad de México">Ciudad de México</option>
                                <option value="Coahuila">Coahuila</option>
                                <option value="Colima">Colima</option>
                                <option value="Durango">Durango</option>
                                <option value="Estado de México">Estado de México</option>
                                <option value="Guanajuato">Guanajuato</option>
                                <option value="Guerrero">Guerrero</option>
                                <option value="Hidalgo">Hidalgo</option>
                                <option value="Jalisco">Jalisco</option>
                                <option value="Michoacán">Michoacán</option>
                                <option value="Morelos">Morelos</option>
                                <option value="Nayarit">Nayarit</option>
                                <option value="Nuevo León">Nuevo León</option>
                                <option value="Oaxaca">Oaxaca</option>
                                <option value="Puebla">Puebla</option>
                                <option value="Querétaro">Querétaro</option>
                                <option value="Quintana Roo">Quintana Roo</option>
                                <option value="San Luis Potosí">San Luis Potosí</option>
                                <option value="Sinaloa">Sinaloa</option>
                                <option value="Sonora">Sonora</option>
                                <option value="Tabasco">Tabasco</option>
                                <option value="Tamaulipas">Tamaulipas</option>
                                <option value="Tlaxcala">Tlaxcala</option>
                                <option value="Veracruz">Veracruz</option>
                                <option value="Yucatán">Yucatán</option>
                                <option value="Zacatecas">Zacatecas</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="filter-materia">Materia</label>
                            <select id="filter-materia">
                                <option value="">Todas las materias</option>
                                <option value="Laboral">Laboral</option>
                                <option value="Penal">Penal</option>
                                <option value="Mercantil">Mercantil</option>
                                <option value="Civil">Civil</option>
                                <option value="Fiscal">Fiscal</option>
                                <option value="Administrativa">Administrativa</option>
                                <option value="Agrario">Agrario</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="filter-prioridad">Prioridad</label>
                            <select id="filter-prioridad">
                                <option value="">Todas las prioridades</option>
                                <option value="Alta">Alta</option>
                                <option value="Media">Media</option>
                                <option value="Baja">Baja</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <table id="tabla-audiencias">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Fecha</th>
                                <th>Hora</th>
                                <th>Tribunal</th>
                                <th>Expediente</th>
                                <th>Actor</th>
                                <th>Acta de Audiencia</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>    
                    <tbody id="audiencias-body">
                            <!-- Los datos se cargarán dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="js/audiencias.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof initAudiencias === 'function') {
                initAudiencias();
            }
        });
    </script>
    <!-- Modal para Audiencias -->
    <div class="modal" id="modal-audiencia">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-audiencia-title">Nueva Audiencia</h2>
                <button class="btn btn-danger" id="close-modal-audiencia">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="form-audiencia">
                    <input type="hidden" id="audiencia-id">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="audiencia-fecha">Fecha</label>
                            <input type="date" id="audiencia-fecha" required>
                        </div>
                        <div class="form-group">
                            <label for="audiencia-hora">Hora</label>
                            <input type="time" id="audiencia-hora" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="audiencia-tipo">Tipo de Audiencia</label>
                            <select id="audiencia-tipo" required>
                                <option value="">Seleccione un tipo</option>
                                <option value="Inicial">Inicial</option>
                                <option value="Intermedia">Intermedia</option>
                                <option value="Ratificación">Ratificación</option>
                                <option value="Admisión">Admisión</option>
                                <option value="Confesional">Confesional</option>
                                <option value="Reanudacion">Reanudación</option>
                                <option value="Incidental">Incidental</option>
                                <option value="Constitucional">Constitucional</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="audiencia-materia">Materia</label>
                            <select id="audiencia-materia" required>
                                <option value="">Seleccione una materia</option>
                                <option value="Laboral">Laboral</option>
                                <option value="Penal">Penal</option>
                                <option value="Mercantil">Mercantil</option>
                                <option value="Civil">Civil</option>
                                <option value="Fiscal">Fiscal</option>
                                <option value="Administrativa">Administrativa</option>
                                <option value="Agrario">Agrario</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="audiencia-tribunal">Tribunal</label>
                            <input type="text" id="audiencia-tribunal" required>
                        </div>
                        <div class="form-group">
                            <label for="audiencia-expediente">Expediente</label>
                            <input type="text" id="audiencia-expediente" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="audiencia-actor">Actor</label>
                            <input type="text" id="audiencia-actor" required>
                        </div>
                        <div class="form-group">
                            <label for="audiencia-demandado">Demandado</label>
                            <input type="text" id="audiencia-demandado" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="audiencia-observaciones">Observaciones</label>
                        <textarea id="audiencia-observaciones" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="audiencia-prioridad">Prioridad</label>
                        <select id="audiencia-prioridad" required>
                            <option value="">Seleccione prioridad</option>
                            <option value="Alta">Alta</option>
                            <option value="Media">Media</option>
                            <option value="Baja">Baja</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="audiencia-acta">Acta de Audiencia</label>
                        <input type="file" id="audiencia-acta" accept=".pdf,.doc,.docx">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" id="cancel-audiencia">Cancelar</button>
                <button class="btn btn-success" id="save-audiencia">Guardar Audiencia</button>
            </div>
        </div>
    </div>
        <!-- nuevo modal  -->
    <!-- Modal Comentarios -->
        <div class="modal" id="modal-comentarios">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
            <h2>Comentarios de la audiencia</h2>
            <button class="btn btn-danger" id="close-modal-comentarios">
                <i class="fas fa-times"></i>
            </button>
            </div>

            <div class="modal-body">
            <input type="hidden" id="comentarios-audiencia-id">
            
            <div class="form-group">
                <label for="nuevo-comentario">Nuevo comentario</label>
                <textarea id="nuevo-comentario" rows="3" placeholder="Escribe tu comentario..."></textarea>
            </div>

            <div class="modal-footer" style="padding-left: 0;">
                <button class="btn btn-success" id="save-comentario">
                <i class="fas fa-paper-plane"></i> Guardar comentario
                </button>
            </div>

            <hr>

            <div>
                <h3 style="margin-top: 0;">Historial</h3>
                <ul id="lista-comentarios" class="comment-list" style="list-style: none; padding-left: 0; margin: 0;">
                <!-- Se llena dinámicamente -->
                </ul>
            </div>
            </div>
        </div>
        </div>

    <!-- Scripts -->
    <script src="js/notificaciones.js"></script>
    <script src="js/audiencias.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof initAudiencias === 'function') {
                initAudiencias();
            }
            initModalAudiencias();
             initModalComentarios(); // <- AÑADIDO
        });

        function initModalAudiencias() {
            // Modal de audiencias
            const modalAudiencia = document.getElementById('modal-audiencia');
            const btnAddAudiencia = document.getElementById('add-audiencia');
            const btnCloseAudiencia = document.getElementById('close-modal-audiencia');
            const btnCancelAudiencia = document.getElementById('cancel-audiencia');
            const btnSaveAudiencia = document.getElementById('save-audiencia');

            // Abrir modal
            if (btnAddAudiencia) {
                btnAddAudiencia.addEventListener('click', function() {
                    openAudienciaModal();
                });
            }

            // Cerrar modal
            if (btnCloseAudiencia) {
                btnCloseAudiencia.addEventListener('click', function() {
                    modalAudiencia.style.display = 'none';
                });
            }

            if (btnCancelAudiencia) {
                btnCancelAudiencia.addEventListener('click', function() {
                    modalAudiencia.style.display = 'none';
                });
            }

            // Guardar audiencia
            if (btnSaveAudiencia) {
                btnSaveAudiencia.addEventListener('click', function() {
                    saveAudiencia();
                });
            }

            // Cerrar modal al hacer clic fuera
            window.addEventListener('click', function(event) {
                if (event.target === modalAudiencia) {
                    modalAudiencia.style.display = 'none';
                }
            });
        }

        function openAudienciaModal(audiencia = null) {
            const modal = document.getElementById('modal-audiencia');
            const title = document.getElementById('modal-audiencia-title');
            const form = document.getElementById('form-audiencia');
            
            if (audiencia) {
                title.textContent = 'Editar Audiencia';
                document.getElementById('audiencia-id').value = audiencia.id;
                document.getElementById('audiencia-fecha').value = audiencia.fecha;
                document.getElementById('audiencia-hora').value = audiencia.hora;
                document.getElementById('audiencia-tipo').value = audiencia.tipo;
                document.getElementById('audiencia-materia').value = audiencia.materia;
                document.getElementById('audiencia-tribunal').value = audiencia.tribunal;
                document.getElementById('audiencia-expediente').value = audiencia.expediente;
                document.getElementById('audiencia-actor').value = audiencia.actor;
                document.getElementById('audiencia-demandado').value = audiencia.demandado;
                document.getElementById('audiencia-observaciones').value = audiencia.observaciones;
                document.getElementById('audiencia-prioridad').value = audiencia.prioridad;
            } else {
                title.textContent = 'Nueva Audiencia';
                if (form) form.reset();
                document.getElementById('audiencia-id').value = '';
            }
            
            modal.style.display = 'flex';
        }

        function saveAudiencia() {
            const id = document.getElementById('audiencia-id').value;
            const fecha = document.getElementById('audiencia-fecha').value;
            const hora = document.getElementById('audiencia-hora').value;
            const tipo = document.getElementById('audiencia-tipo').value;
            const materia = document.getElementById('audiencia-materia').value;
            const tribunal = document.getElementById('audiencia-tribunal').value;
            const expediente = document.getElementById('audiencia-expediente').value;
            const actor = document.getElementById('audiencia-actor').value;
            const demandado = document.getElementById('audiencia-demandado').value;
            const observaciones = document.getElementById('audiencia-observaciones').value;
            const prioridad = document.getElementById('audiencia-prioridad').value;
            
            if (!fecha || !hora || !tipo || !materia || !tribunal || !expediente || !actor || !demandado || !prioridad) {
                alert('Por favor, complete todos los campos obligatorios');
                return;
            }

            // Registrar notificación si corresponde
            try {
                const notifyType = document.getElementById('audiencia-notify-type').value;
                const offset = document.getElementById('audiencia-notify-offset').value;
                const eventISO = fecha + 'T' + hora;
                if (notifyType && offset && window.Notificaciones && typeof window.Notificaciones.add === 'function') {
                    window.Notificaciones.add({
                        eventType: 'audiencia',
                        title: tipo + ' - ' + tribunal,
                        expediente: expediente,
                        eventAtISO: eventISO,
                        notifyType: notifyType,
                        offset: Number(offset)
                    });
                }
            } catch (e) {
                console.warn('No se pudo registrar notificación', e);
            }

            alert('Audiencia guardada correctamente:\n' +
                  'Fecha: ' + fecha + '\n' +
                  'Hora: ' + hora + '\n' +
                  'Tipo: ' + tipo + '\n' +
                  'Expediente: ' + expediente);

            // Cerrar modal
            document.getElementById('modal-audiencia').style.display = 'none';

            // Aquí podrías recargar la tabla o agregar la nueva audiencia
        }
    </script>
</body>
</html>